<head>
  <meta charset="utf-8" />
  <style>
body {
  margin: 0;
  padding: 0;
  font-family: sans-serif;
}
path {
  stroke: #ccc;
  stroke-width: 4;
  fill: none;
  stroke-linecap: round;
  stroke-linejoin: round;
}
path#track-gongliao-xincheng {
  stroke: #000;
}
#conversation {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 500px;
  overflow: scroll;
}
  </style>
</head>
<body>
  <div id="clock">0</div>
  <svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" width="540px" height="640px" viewBox="0 0 540 640" version="1.1" >
    <path d="M31,112 C48.4590805,108.009257 68.1257472,105.675924 90,105 C122.021378,104.73161 171.136275,93.003473 179,88 C187.178417,82.3308684 185.240545,69.504196 192,67 C199.266675,64.4376408 204.642706,74.7232169 221,70 C237.43025,64.2851751 237.602158,39.9258347 253,36 C268.944112,31.614495 270.28812,44.890746 291,40 C312.022694,34.9609234 315.773413,21.5087504 341,29 C366.580041,37.4042853 348.013977,55.9855635 351,76 C353.835407,96.8854863 367.255952,81.9477492 382,88 C393.672158,93.5587821 399.338825,101.558782 399,112 C398.679953,128.011962 414.081347,134.841647 433,132 C451.463522,129.798548 475.120407,124.204227 489,135 C502.414709,146.440774 503.17462,160.147057 493,174 C487.919294,181.208284 473.636053,190.314934 462,196 C454.029666,199.351103 448.754018,202.043871 444,209 C439.623359,216.254464 432.772434,230.564745 423,234 C413.456227,238.274041 417.252854,252.702581 411,258 C404.498452,263.191445 396.160915,277.484134 382,292 C368.770891,307.017538 361.824245,319.12293 351,328 C340.025139,336.695588 343.145855,352.651719 327,354 C311.616366,354.737372 301.383933,356.190684 299,376 C296.304833,395.417392 291.675038,414.795207 291,442 C290.635776,468.478799 309.627703,482.471443 311,503 C311.589017,522.824053 302.038355,532.550588 312,560 C322.518849,587.844844 341.176727,579.819866 358,606" id="track-taipei-xincheng"></path>
    <path d="M462.233623,128.643107 C472.370772,128.260612 481.947549,129.514489 489,135 C502.414709,146.440774 503.17462,160.147057 493,174 C487.919294,181.208284 473.636053,190.314934 462,196 C454.029666,199.351103 448.754018,202.043871 444,209 C439.623359,216.254464 432.772434,230.564745 423,234 C413.456227,238.274041 417.252854,252.702581 411,258 C404.498452,263.191445 396.160915,277.484134 382,292 C368.770891,307.017538 361.824245,319.12293 351,328 C340.025139,336.695588 343.145855,352.651719 327,354 C311.616366,354.737372 301.383933,356.190684 299,376 C296.304833,395.417392 291.675038,414.795207 291,442 C290.635776,468.478799 309.627703,482.471443 311,503 C311.589017,522.824053 302.038355,532.550588 312,560 C322.518849,587.844844 341.176727,579.819866 358,606" id="track-gongliao-xincheng"></path>
    <circle id="train" r="6">
      <animateMotion dur="60s" rotate="auto" fill="freeze">
        <mpath xlink:href="#track-gongliao-xincheng"></mpath>
      </animateMotion>
    </circle>
  </svg>
  <div id="conversation">
  </div>
</body>
<script src="record.js"></script>
<script>
record = record.map(entry => {
  entry.timestamp = new Date('2018-10-21T' + entry.time).getTime()
  return entry
})

let clock = 0
let clockElement = document.getElementById('clock')
let conversationElement = document.getElementById('conversation')
let pause = 0
let index = 0
let animationDuration = 60000
let actualDuration = record[record.length - 1].timestamp - record[0].timestamp
let actualToAnimationDuration = animationDuration / actualDuration
let animationToActualDuration = actualDuration / animationDuration

function displayEntry(entry) {
  let el = document.createElement('div')
  el.innerHTML = entry.content
  conversationElement.appendChild(el)
  conversationElement.scrollTo(0, conversationElement.scrollHeight)
}
function show() {
  displayEntry(record[index])
  if(index + 1 < record.length) {
    pause = (record[index + 1].timestamp - record[index].timestamp) * actualToAnimationDuration
    index = index + 1
    setTimeout(show, pause)
  }
}

show()

clockElement.innerHTML = record[0].time
let clockInterval = 1000
let clockHandle = setInterval(() => {
  clock = clock + clockInterval
  let dateObj = new Date(record[0].timestamp + clock * animationToActualDuration)
  clockElement.innerHTML = dateObj.toLocaleString()
  if(clock >= animationDuration) {
    clearInterval(clockHandle)
  }
}, clockInterval)
</script>
